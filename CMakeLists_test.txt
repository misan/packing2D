cmake_minimum_required(VERSION 3.14)
project(Packing2D_CPP)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

if(APPLE)
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++17 -stdlib=libc++ -D_LIBCPP_ENABLE_PARALLEL_ALGORITHMS -march=native -mtune=native -O3")
endif()

if(CMAKE_SYSTEM_NAME STREQUAL "Linux")
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O3 -march=native -mtune=native")
endif()

# --- Dependencies ---
find_package(Boost 1.71.0 CONFIG REQUIRED)
if(NOT Boost_FOUND)
    message(FATAL_ERROR "Boost not found. Please install Boost.")
endif()

find_package(TBB REQUIRED)

# --- Library ---
add_library(packing_lib STATIC
    src/primitives/MArea.cpp
    src/primitives/MVector.cpp
    src/utils/Utils.cpp
    src/core/Bin.cpp
    src/core/BinPacking.cpp
)
set_target_properties(packing_lib PROPERTIES POSITION_INDEPENDENT_CODE ON)

target_include_directories(packing_lib PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/src
)
target_link_libraries(packing_lib PUBLIC Boost::headers TBB::tbb)

# --- Executable ---
add_executable(packing_main src/main.cpp)
target_link_libraries(packing_main PRIVATE packing_lib TBB::tbb)

message(STATUS "Project configured. Build with 'cmake --build .'")